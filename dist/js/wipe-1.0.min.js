/*!wipe-zw 1.0 发布日期: 2018-11-14*/
var x,y,x2,y2,t,cas=document.getElementById("cas"),context=cas.getContext("2d"),raduis=20,_w=cas.width,_h=cas.height,ismousedown=!1,device=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase());alert(navigator.userAgent),console.log(device);var clickEvtName=device?"touchstart":"mousedown",moveEvtName=device?"touchmove":"mousemove",endEvtName=device?"touchend":"mouseup";function drawMask(e){e.save(),e.fillStyle="rgba(122,122,122,.9)",e.fillRect(0,0,_w,_h),e.restore(),e.globalCompositeOperation="destination-out"}function drawT(e,t,n,o,a){e.save(),e.beginPath(),3===arguments.length?(e.arc(t,n,raduis,0,2*Math.PI),e.fillStyle="#eee",e.fill()):(e.lineWidth=2*raduis,e.moveTo(t,n),e.lineTo(o,a),e.stroke()),e.restore()}function clearRect(e){e.clearRect(0,0,_w,_h)}function getTransparencyPercent(e){var n=e.getImageData(0,0,_w,_h);console.log(n);for(var o=0;o<n.data.length;o+=4){0===n.data[o+3]&&t++}var a=t/(_w*_h)*100;return console.log("透明点个数: "+t),console.log("占总面积: "+Math.ceil(a)+"%"),Math.round(a)}cas.addEventListener(clickEvtName,function(e){ismousedown=!0;var t=e||window.event;x=device?t.touches[0].clientX:t.clientX,y=device?t.touches[0].clientY:t.clientY,drawT(context,x,y)},!1),cas.addEventListener(moveEvtName,function(e){if(!ismousedown)return!1;var t=e||window.event;t.preventDefault(),x2=device?t.touches[0].clientX:t.clientX,y2=device?t.touches[0].clientY:t.clientY,drawT(context,x,y,x2,y2),x=x2,y=y2},!1),cas.addEventListener(endEvtName,function(){ismousedown=!1,t=0,50<getTransparencyPercent(context)&&clearRect(context)},!1),window.onload=function(){drawMask(context),drawT(context)};