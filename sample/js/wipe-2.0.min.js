/*!wipe-zw 2.0 发布日期: 2018-11-19*/
function Wipe(t){this.conID=t.id,this.cas=document.getElementById(this.conID),this.cas.style.backgroundImage="url("+t.backImgurl+")",this.context=cas.getContext("2d"),this._w=t.width,this._h=t.height,this.radius=t.radius,this.moveX=0,this.moveY=0,this.isMouseDown=!1,this.color=t.color||"#666",this.imgurl=t.imgurl,this.coverType=t.coverType,this.wipeCallback=t.wipeCallback,this.transpercent=t.percent,this.drawMask(),this.addEvent()}Wipe.prototype.drawMask=function(){if("color"===this.coverType)this.context.fillStyle=this.color,this.context.fillRect(0,0,this._w,this._h),this.context.globalCompositeOperation="destination-out";else{var t=new Image;t.src=this.imgurl;var e=this;t.onload=function(){e.context.drawImage(t,0,0,t.width,t.height,0,0,e._w,e._h),e.context.globalCompositeOperation="destination-out"}}},Wipe.prototype.drawT=function(t,e,i,o){if(2===arguments.length)this.context.save(),this.context.beginPath(),this.context.arc(t,e,this.radius,0,2*Math.PI),this.context.fillStyle="rgba(255,255,255,255)",this.context.fill(),this.context.restore();else{if(4!==arguments.length)return!1;this.context.save(),this.context.beginPath(),this.context.lineCap="round",this.context.lineWidth=2*this.radius,this.context.moveTo(t,e),this.context.lineTo(i,o),this.context.stroke(),this.context.restore()}},Wipe.prototype.clearRect=function(){this.context.clearRect(0,0,this._w,this._h)},Wipe.prototype.getTransparencyPercent=function(){for(var t=0,e=this.context.getImageData(0,0,this._w,this._h),i=0;i<e.data.length;i+=4){0===e.data[i+3]&&t++}return this.percents=t/(this._w*this._h)*100,console.log("占总面积"+Math.ceil(this.percents)+"%"),this.percents.toFixed(2)},Wipe.prototype.addEvent=function(){this.device=/android|webos|iPhone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),console.log(this.device);var t=this.device?"touchstart":"mousedown",e=this.device?"touchmove":"mousemove",i=this.device?"touchend":"mouseup",s=this;this.cas.addEventListener(t,function(t){s.isMouseDown=!0;var e=t||window.event;s.moveX=s.device?e.touches[0].clientX:e.clientX,s.moveY=s.device?e.touches[0].clientY:e.clientY,s.drawT(s.moveX,s.moveY)},!1),this.cas.addEventListener(e,function(t){if(console.log(s.isMouseDown),!s.isMouseDown)return!1;var e=t||window.event;e.preventDefault();var i=s.device?e.touches[0].clientX:e.clientX,o=s.device?e.touches[0].clientY:e.clientY;s.drawT(s.moveX,s.moveY,i,o),s.moveX=i,s.moveY=o},!1),this.cas.addEventListener(i,function(){s.isMouseDown=!1;var t=s.getTransparencyPercent();s.wipeCallback.call(window,t),t>s.transpercent&&(alert("超过了50%的面积"),s.clearRect())},!1)};